<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Symptom Checker – Chat + Body Map Demo</title>
  <style>
    :root{
      --bg:#0b1220;--panel:#121a2b;--muted:#92a1b3;--text:#e6ecf2;--accent:#66d9e8;--accent-2:#a78bfa;--danger:#ff6b6b;--ok:#51cf66;
      --card:#0f1626;--chip:#1c2541;--shadow:0 10px 30px rgba(0,0,0,.35)
    }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 600px at 70% -20%,#17223a 0%,#0b1220 60%,#0b1220 100%) fixed;color:var(--text);font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    a{color:var(--accent)}
    .wrap{max-width:1200px;margin:auto;padding:24px}
    header{display:flex;align-items:center;gap:12px;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:grid;place-items:center;color:#0b1220;font-weight:900;box-shadow:var(--shadow)}
    .title{font-weight:800;letter-spacing:.3px}
    .disclaimer{color:var(--muted);font-size:13px}

    .grid{display:grid;grid-template-columns: 360px 1fr; gap:20px; margin-top:18px}
    @media (max-width: 960px){.grid{grid-template-columns:1fr}}

    .panel{background:rgba(255,255,255,.03);backdrop-filter: blur(6px); border:1px solid rgba(255,255,255,.06); border-radius:20px; box-shadow:var(--shadow)}
    .left{padding:18px}
    .right{display:flex;flex-direction:column;overflow:hidden}

    .section h3{margin:6px 0 8px;font-size:15px;color:#b9c6d4;font-weight:700;letter-spacing:.2px}
    .chips{display:flex;flex-wrap:wrap;gap:8px}
    .chip{background:var(--chip);color:#cfe3f5;border:1px solid rgba(255,255,255,.08);padding:8px 12px;border-radius:999px;font-size:13px;cursor:pointer;transition:.18s transform, .18s background}
    .chip:hover{transform:translateY(-1px)}
    .chip.active{outline:2px solid var(--accent);background:#112238}

    .body-map{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
    .body-btn{padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.08);background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));cursor:pointer;text-align:left}
    .body-btn:hover{outline:2px solid rgba(102,217,232,.25)}

    .search{display:flex;gap:8px;margin:10px 0 4px}
    .search input{flex:1;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#0e1627;color:var(--text)}
    .btn{padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:linear-gradient(135deg,#1e2743,#19233b);color:#e7f8ff;cursor:pointer}
    .btn.primary{background:linear-gradient(135deg,#1b3a4b,#0b7285);border-color:#0b7285}
    .btn.ghost{background:transparent}

    /* Chat */
    .chat{flex:1;display:flex;flex-direction:column;padding:16px;gap:12px;overflow:auto}
    .bubble{max-width:78%;padding:12px 14px;border-radius:16px;border:1px solid rgba(255,255,255,.08);background:var(--card);box-shadow:var(--shadow)}
    .bot{align-self:flex-start;background:linear-gradient(180deg,#111a2e,#0e172a)}
    .you{align-self:flex-end;background:linear-gradient(180deg,#12253a,#11324a)}
    .meta{font-size:12px;color:#9eb1c7;margin-top:6px}
    .chat-input{display:flex;gap:8px;padding:12px;border-top:1px solid rgba(255,255,255,.06);background:rgba(255,255,255,.03)}
    .chat-input input, .chat-input select{flex:1;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:#0e1627;color:var(--text)}

    .result{padding:16px;border-top:1px dashed rgba(255,255,255,.08);display:none}
    .cond{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;margin:8px 0;border:1px solid rgba(255,255,255,.08);border-radius:14px;background:linear-gradient(180deg,#111a2e,#0d1526)}
    .badge{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.12)}
    .risk-low{color:var(--ok);border-color:rgba(81,207,102,.4)}
    .risk-med{color:#ffd43b;border-color:rgba(255,212,59,.4)}
    .risk-high{color:var(--danger);border-color:rgba(255,107,107,.4)}
    .foot{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .tiny{font-size:12px;color:#9fb2c8}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">SC</div>
        <div>
          <div class="title">Symptom Checker – Demo</div>
          <div class="disclaimer">Not a medical diagnosis. For emergencies, call local emergency services.</div>
        </div>
      </div>
      <div>
        <button id="btn-reset" class="btn ghost">Reset</button>
        <button id="btn-start" class="btn primary">Start Symptom Check</button>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: Body Map + Quick symptoms -->
      <aside class="panel left" id="leftPanel">
        <div class="section">
          <h3>Select a body area</h3>
          <div class="body-map" id="bodyMap">
            <!-- Buttons populated by JS -->
          </div>
        </div>
        <div class="section">
          <h3>Common symptoms</h3>
          <div class="chips" id="commonChips"></div>
        </div>
        <div class="section">
          <h3>Add a symptom</h3>
          <div class="search">
            <input id="symptomInput" placeholder="e.g., fever, cough, headache" />
            <button class="btn" id="addSymptom">Add</button>
          </div>
          <div class="chips" id="selectedChips"></div>
        </div>
      </aside>

      <!-- RIGHT: Chat + Results -->
      <section class="panel right">
        <div class="chat" id="chat"></div>
        <div class="chat-input">
          <select id="answerSelect">
            <option value="">Choose an answer…</option>
          </select>
          <button class="btn primary" id="sendAnswer">Send</button>
        </div>
        <div class="result" id="resultPanel">
          <h3>Possible causes</h3>
          <div id="conditions"></div>
          <div class="foot tiny">
            <div>Results are educational. See a clinician for diagnosis.</div>
            <button class="btn" id="restart">Restart</button>
          </div>
        </div>
      </section>
    </div>
  </div>

  <script>
  // === Simple data (demo only; not medical advice) ===
  const BODY_AREAS = [
    { id:'head', label:'Head & Face', common:['headache','sore throat','runny nose','dizziness'] },
    { id:'chest', label:'Chest & Lungs', common:['cough','shortness of breath','chest pain'] },
    { id:'abdomen', label:'Abdomen', common:['stomach pain','nausea','vomiting','diarrhea'] },
    { id:'limbs', label:'Arms & Legs', common:['joint pain','muscle ache','swelling'] },
    { id:'skin', label:'Skin', common:['rash','itching','hives'] },
    { id:'general', label:'General', common:['fever','fatigue','chills','loss of appetite'] },
  ];

  // A tiny rule base: condition -> symptoms with weights + followups
  const CONDITIONS = {
    'Common Cold': {
      tags:['head','general'],
      symptoms: { 'runny nose':2, 'sore throat':2, 'cough':1, 'sneezing':1, 'mild fever':1, 'fatigue':1 },
      advice:'Rest, fluids, OTC cold remedies. See a doctor if symptoms persist >10 days or high fever.'
    },
    'Influenza (Flu)': {
      tags:['general','head','chest'],
      symptoms: { 'fever':3, 'chills':2, 'body ache':2, 'cough':2, 'fatigue':2, 'headache':1 },
      advice:'Hydrate, rest, antipyretics. High-risk groups should consult a clinician promptly.'
    },
    'COVID-19 (likely)': {
      tags:['general','chest','head'],
      symptoms: { 'fever':2, 'cough':2, 'loss of smell':3, 'sore throat':1, 'shortness of breath':2, 'fatigue':1 },
      advice:'Isolate, test if available, wear a mask, and follow local health guidance.'
    },
    'Gastroenteritis': {
      tags:['abdomen','general'],
      symptoms: { 'diarrhea':3, 'vomiting':3, 'stomach pain':2, 'nausea':2, 'fever':1 },
      advice:'Oral rehydration, light diet. Seek care for dehydration or blood in stool.'
    },
    'Migraine': {
      tags:['head'],
      symptoms: { 'headache':3, 'nausea':2, 'light sensitivity':2, 'sound sensitivity':2, 'aura':2 },
      advice:'Quiet dark room, hydration, migraine-specific meds if prescribed.'
    },
    'Acid Reflux (GERD)': {
      tags:['chest','abdomen'],
      symptoms: { 'heartburn':3, 'chest pain':2, 'sour taste':2, 'cough':1, 'nausea':1 },
      advice:'Avoid trigger foods, don’t lie down after meals, consider antacids; see a clinician if frequent.'
    }
  };

  // Follow-up question templates keyed by symptom
  const FOLLOWUPS = {
    'fever': { q:'Do you have fever (≥38°C)?', options:['Yes','No','Not sure'] },
    'cough': { q:'Is your cough dry or productive?', options:['Dry','Productive','No cough'] },
    'shortness of breath': { q:'Are you experiencing shortness of breath?', options:['Yes','No'] },
    'runny nose': { q:'Do you have a runny or stuffy nose?', options:['Yes','No'] },
    'headache': { q:'Is the headache moderate to severe?', options:['Mild','Moderate','Severe','No'] },
    'sore throat': { q:'Is your throat sore or painful?', options:['Yes','No'] },
    'loss of smell': { q:'Any recent loss of smell or taste?', options:['Yes','No'] },
    'vomiting': { q:'Are you vomiting repeatedly?', options:['Yes','No'] },
    'diarrhea': { q:'Do you have frequent loose stools?', options:['Yes','No'] },
    'stomach pain': { q:'Is your stomach pain crampy or burning?', options:['Crampy','Burning','Mild','No pain'] },
    'chest pain': { q:'Is the chest pain sharp and worsens with breathing?', options:['Yes','No'] },
  };

  // Emergency red flags (very simplified)
  const RED_FLAGS = [
    { key:'chest pain', text:'Severe chest pain, sweating, or breathlessness can be an emergency. Seek urgent care.' },
    { key:'shortness of breath', text:'Sudden shortness of breath can be serious. Seek urgent care.' },
    { key:'stiff neck', text:'Severe headache with stiff neck or confusion needs urgent evaluation.' },
    { key:'dehydration', text:'Signs of severe dehydration (very dry mouth, no urination, dizziness) — seek care.' }
  ];

  // === State ===
  const state = {
    selected: new Set(),
    area: null,
    chat: [], // {role:'bot'|'you', text}
    pendingQ: null, // current followup symptom key
    answers: {}, // symptom -> chosen answer
    finished: false,
  };

  const chatEl = document.getElementById('chat');
  const answerSel = document.getElementById('answerSelect');
  const sendBtn = document.getElementById('sendAnswer');
  const resultPanel = document.getElementById('resultPanel');
  const condEl = document.getElementById('conditions');

  // === UI builders ===
  function renderBodyMap(){
    const holder = document.getElementById('bodyMap');
    holder.innerHTML = '';
    BODY_AREAS.forEach(a=>{
      const btn = document.createElement('button');
      btn.className = 'body-btn';
      btn.textContent = a.label;
      btn.onclick = ()=>{
        state.area = a.id; renderCommonChips();
        tip(`Focusing on <b>${a.label}</b>. Add symptoms or choose from common ones below.`);
      };
      holder.appendChild(btn);
    });
  }

  function renderCommonChips(){
    const holder = document.getElementById('commonChips');
    holder.innerHTML = '';
    const area = BODY_AREAS.find(x=>x.id===state.area);
    const commons = area ? area.common : BODY_AREAS.flatMap(x=>x.common.slice(0,2));
    commons.forEach(s=>holder.appendChild(makeChip(s)));
    renderSelected();
  }

  function makeChip(sym){
    const el = document.createElement('div');
    el.className = 'chip';
    el.textContent = sym;
    if(state.selected.has(sym)) el.classList.add('active');
    el.onclick = ()=>{
      if(state.selected.has(sym)) state.selected.delete(sym); else state.selected.add(sym);
      el.classList.toggle('active');
      onSymptomsChanged();
    };
    return el;
  }

  function renderSelected(){
    const holder = document.getElementById('selectedChips');
    holder.innerHTML = '';
    [...state.selected].forEach(s=>holder.appendChild(makeChip(s)));
  }

  function tip(html){
    pushChat('bot', html);
  }
  function pushChat(role, html){
    state.chat.push({role, html});
    const b = document.createElement('div');
    b.className = 'bubble ' + (role==='bot'?'bot':'you');
    b.innerHTML = html;
    chatEl.appendChild(b);
    chatEl.scrollTop = chatEl.scrollHeight;
  }

  function setAnswerOptions(opts){
    answerSel.innerHTML = '<option value="">Choose an answer…</option>';
    opts.forEach(o=>{
      const op = document.createElement('option');
      op.value = o; op.textContent = o; answerSel.appendChild(op);
    });
  }

  function askNextFollowup(){
    // Pick the first selected symptom without an answer and with a followup
    const target = [...state.selected].find(s=>FOLLOWUPS[s] && !state.answers[s]);
    if(target){
      state.pendingQ = target;
      const f = FOLLOWUPS[target];
      tip(f.q);
      setAnswerOptions(f.options);
      return true;
    }
    return false;
  }

  function scoreConditions(){
    const scores = [];
    const selected = [...state.selected];
    const answers = state.answers;
    for(const [cond, meta] of Object.entries(CONDITIONS)){
      let s=0, max=0;
      for(const [sym,w] of Object.entries(meta.symptoms)){
        max += w;
        if(selected.includes(sym)){
          // Adjust weight a bit based on follow-up answers
          let mult = 1;
          const ans = answers[sym];
          if(ans){
            if(sym==='cough' && ans==='Dry') mult=1.1; // tiny bias
            if(sym==='fever' && ans==='Yes') mult=1.2;
            if(sym==='chest pain' && ans==='Yes') mult=1.3;
          }
          s += w*mult;
        }
      }
      const pct = max? Math.round((s/max)*100):0;
      if(pct>0) scores.push({cond, pct, advice: meta.advice});
    }
    // Sort high to low
    scores.sort((a,b)=>b.pct-a.pct);
    return scores.slice(0,5);
  }

  function showResults(){
    const scores = scoreConditions();
    condEl.innerHTML = '';
    if(!scores.length){
      condEl.innerHTML = '<div class="tiny">Not enough information yet. Try adding 2–3 symptoms, then we’ll estimate causes.</div>';
    }
    scores.forEach(x=>{
      const row = document.createElement('div');
      row.className = 'cond';
      const risk = x.pct>=70? 'risk-high' : x.pct>=40? 'risk-med' : 'risk-low';
      row.innerHTML = `<div><div style="font-weight:700">${x.cond}</div><div class="tiny">${x.advice}</div></div>
        <div class="badge ${risk}">${x.pct}% match</div>`;
      condEl.appendChild(row);
    });

    // Red flag tips
    const flags = RED_FLAGS.filter(f=>state.selected.has(f.key));
    if(flags.length){
      flags.forEach(f=>{
        const warn = document.createElement('div');
        warn.className = 'bubble bot';
        warn.innerHTML = `<b>Red flag:</b> ${f.text}`;
        chatEl.appendChild(warn);
      });
      chatEl.scrollTop = chatEl.scrollHeight;
    }

    resultPanel.style.display = 'block';
  }

  function onSymptomsChanged(){
    renderSelected();
    if(state.selected.size===0){
      setAnswerOptions([]); state.pendingQ=null; return;
    }
    // Ask next follow-up if needed; otherwise show provisional results
    if(!askNextFollowup()){
      setAnswerOptions([]);
      tip('Thanks. Based on what you’ve added, here are some possibilities.');
      showResults();
    }
  }

  // === Event wiring ===
  document.getElementById('btn-start').onclick = ()=>{
    tip('Hi! I can help you think through symptoms. Start by selecting a body area on the left or add a symptom.');
  };

  document.getElementById('btn-reset').onclick = ()=>{
    Object.assign(state, { selected:new Set(), area:null, chat:[], pendingQ:null, answers:{}, finished:false });
    chatEl.innerHTML='';
    condEl.innerHTML='';
    resultPanel.style.display='none';
    renderCommonChips();
  };

  document.getElementById('addSymptom').onclick = ()=>{
    const v = document.getElementById('symptomInput').value.trim().toLowerCase();
    if(!v) return;
    state.selected.add(v);
    document.getElementById('symptomInput').value='';
    onSymptomsChanged();
  };

  document.getElementById('restart').onclick = ()=>{
    document.getElementById('btn-reset').click();
  };

  sendBtn.onclick = ()=>{
    const v = answerSel.value;
    if(!state.pendingQ || !v) return;
    pushChat('you', v);
    state.answers[state.pendingQ] = v;
    state.pendingQ = null;
    // After answering, try to ask another follow-up or show results
    if(!askNextFollowup()){
      tip('Got it. Here’s what I can infer so far.');
      showResults();
    }
    // Clear selection dropdown
    answerSel.selectedIndex = 0;
  };

  // Initialize UI
  renderBodyMap();
  renderCommonChips();
  tip('Welcome! This is a demo mixing a body-part selector (like WebMD) with a chat flow (like Buoy).');
  </script>
</body>
</html>